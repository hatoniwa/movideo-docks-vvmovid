<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Audio Image Game ‚Äì Pharaoh Edition</title>
<style>
  :root {
    --bg: #000;
    --fg: #fff;
    --accent: #ffd54a;
    --btn-blue: #2196f3;
    --btn-green: #28a745;
    --btn-red: #dc3545;
  }

  body {
    margin: 0;
    font-family: "Segoe UI", "Noto Sans JP", sans-serif;
    background: var(--bg);
    color: var(--fg);
    text-align: center;
    overflow: hidden;
  }

  h1 {
    margin-top: 20px;
    font-size: 26px;
    letter-spacing: 2px;
    color: var(--accent);
    text-shadow: 0 0 15px rgba(255, 213, 74, 0.7);
  }

  .button-grid {
    display: flex;
    justify-content: center;
    gap: 10px;
    flex-wrap: wrap;
    margin-top: 20px;
  }

  button {
    padding: 10px 18px;
    font-size: 18px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    color: white;
    transition: 0.2s;
  }

  .img-select-btn { background: var(--btn-blue); }
  .img-select-btn:hover { background: #1976d2; }

  .audio-btn { background: var(--btn-green); }
  .audio-btn:hover { background: #1e7e34; }

  #end-btn { background: var(--btn-red); margin-top: 15px; }
  #end-btn:hover { background: #b02a37; }

  #image-display img {
    width: 320px;
    height: auto;
    border: 3px solid var(--accent);
    border-radius: 10px;
    margin-top: 20px;
    box-shadow: 0 0 20px rgba(255, 213, 74, 0.6);
  }

  #result, #score, #game-over {
    margin-top: 20px;
    font-size: 18px;
    font-weight: bold;
  }

  #result.correct { color: #00e676; text-shadow: 0 0 10px #00e676; }
  #result.wrong { color: #ff5252; text-shadow: 0 0 10px #ff1744; }

  /* üéµ BGM„Éú„Çø„É≥ */
  #bgm-toggle {
    position: fixed;
    top: 10px;
    right: 12px;
    background: var(--accent);
    color: #000;
    font-weight: bold;
    border: none;
    border-radius: 8px;
    padding: 8px 14px;
    cursor: pointer;
    box-shadow: 0 0 8px rgba(255, 213, 74, 0.8);
  }

  /* üéì Ê≠£Ëß£ÊÉÖÂ†±„Ç¶„Ç£„É≥„Éâ„Ç¶ */
  #answer-box {
    display: none;
    margin: 15px auto;
    width: 90%;
    max-width: 420px;
    background: rgba(255,255,255,0.05);
    border: 1px solid var(--accent);
    border-radius: 10px;
    padding: 10px;
    box-shadow: 0 0 10px rgba(255,213,74,0.3);
  }

  #answer-box table {
    width: 100%;
    border-collapse: collapse;
    font-size: 14px;
  }
  #answer-box th, #answer-box td {
    border: 1px solid #666;
    padding: 4px 6px;
  }
  #answer-box th { background: rgba(255,213,74,0.15); }

  /* üé¨ ÁµÇ‰∫Ü„É°„Éã„É•„Éº */
  #end-menu {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.85);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 200;
  }

  #end-menu .menu-box {
    background: #111;
    border: 2px solid var(--accent);
    padding: 25px;
    border-radius: 12px;
    box-shadow: 0 0 25px rgba(255, 213, 74, 0.7);
    width: 280px;
  }

  #end-menu h3 {
    margin-bottom: 10px;
    color: var(--accent);
  }

  #end-menu button {
    margin: 8px;
    padding: 8px 16px;
    border-radius: 6px;
    border: none;
    font-weight: bold;
    cursor: pointer;
  }

  #go-home { background: var(--btn-blue); }
  #watch-yt { background: var(--btn-green); }
  #cancel-end { background: var(--btn-red); }

  #score { color: var(--accent); }

  label { display:inline-block; margin-top:10px; font-size:15px; }
</style>
</head>
<body>
<h1>Audio Image Game ‚Äì Pharaoh Edition</h1>
<button id="bgm-toggle">üéµ Play BGM</button>

<label><input type="checkbox" id="show-answers"> Show answer info</label>

<div id="answer-box">
  <div id="per-image" style="margin-bottom:6px;font-weight:bold;"></div>
  <div id="summary"></div>
</div>

<div id="image-display"></div>
<div class="button-grid" id="audio-buttons"></div>
<div class="button-grid" id="image-buttons"></div>

<div id="result"></div>
<div id="score">Score: 0</div>
<div id="game-over"></div>
<button id="end-btn">End Game</button>

<audio id="bgm" src="https://hatoniwa.github.io/game-commons/bgm.mp3" loop></audio>

<div id="end-menu">
  <div class="menu-box">
    <h3>End Game?</h3>
    <p>Select your next action.</p>
    <button id="go-home">üè† Back to Intro</button>
    <button id="watch-yt">üé• Watch on YouTube</button>
    <button id="cancel-end">‚ùå Continue Playing</button>
  </div>
</div>

<script>
const imageCount=5;
const audioLabels=['A','B','C','D','E'];
const scoreTable=[50,40,30,20,10];
const correctMap={};
const indices=[1,2,3,4,5];
const shuffled=[...indices].sort(()=>Math.random()-0.5);
indices.forEach((img,i)=>correctMap[img]=shuffled[i]);

let selectedImage=null;
let answeredImages=new Set();
let attempts={},totalScore=0;
const imageButtons=document.getElementById('image-buttons');
const audioButtons=document.getElementById('audio-buttons');
const imageDisplay=document.getElementById('image-display');
const resultDisplay=document.getElementById('result');
const scoreDisplay=document.getElementById('score');
const gameOverDisplay=document.getElementById('game-over');
const endBtn=document.getElementById('end-btn');
const bgm=document.getElementById('bgm');
const bgmToggle=document.getElementById('bgm-toggle');
let bgmPlaying=false;

// üéì Ê≠£Ëß£ÊÉÖÂ†±„Ç¶„Ç£„É≥„Éâ„Ç¶
const showAnswersCheckbox=document.getElementById('show-answers');
const answerBox=document.getElementById('answer-box');
const perImage=document.getElementById('per-image');
const summary=document.getElementById('summary');

function updateAnswerHints(){
  if(!showAnswersCheckbox.checked){
    answerBox.style.display='none';
    return;
  }
  answerBox.style.display='block';

  if(selectedImage){
    const corr=correctMap[selectedImage];
    perImage.textContent=`Selected: Image ${selectedImage} ‚Üí Audio ${audioLabels[corr-1]} (scene${corr}_jp.mp3)`;
  } else {
    perImage.textContent='Select an image to see its match.';
  }

  let html='<table><tr><th>Image</th><th>Correct Audio</th><th>File</th></tr>';
  for(let i=1;i<=imageCount;i++){
    const c=correctMap[i];
    html+=`<tr>
      <td>Image ${i}</td>
      <td>Audio ${audioLabels[c-1]}</td>
      <td>scene${c}_jp.mp3</td>
    </tr>`;
  }
  html+='</table>';
  summary.innerHTML=html;
}

// üéµ Setup
function setupImageButtons(){
  for(let i=1;i<=imageCount;i++){
    const btn=document.createElement('button');
    btn.className='img-select-btn';
    btn.textContent=`Image ${i}`;
    btn.onclick=()=>selectImage(i);
    imageButtons.appendChild(btn);
    attempts[i]=0;
  }
}
function setupAudioButtons(){
  for(let i=0;i<audioLabels.length;i++){
    const btn=document.createElement('button');
    btn.className='audio-btn';
    btn.textContent=`Audio ${audioLabels[i]}`;
    const idx=i+1;
    btn.onclick=()=>handleAnswer(idx);
    audioButtons.appendChild(btn);
  }
}
function selectImage(index){
  if(answeredImages.has(index))return;
  selectedImage=index;
  imageDisplay.innerHTML=`<img src="scene${index}.jpg" alt="scene${index}">`;
  resultDisplay.textContent='';
  updateAnswerHints();
}
function handleAnswer(audioIndex){
  if(!selectedImage||answeredImages.has(selectedImage))return;
  const correct=correctMap[selectedImage];
  attempts[selectedImage]++;

  const audio=new Audio(`scene${audioIndex}_jp.mp3`);
  if(bgmPlaying) bgm.pause();
  audio.play().catch(()=>{});
  audio.onended=()=>{ if(bgmPlaying) bgm.play().catch(()=>{}); };

  if(audioIndex===correct){
    const earned=scoreTable[Math.min(attempts[selectedImage]-1,4)];
    resultDisplay.textContent=`Correct! +${earned}`;
    resultDisplay.className='correct';
    totalScore+=earned;
    answeredImages.add(selectedImage);
    selectedImage=null;
    imageDisplay.innerHTML='';
  } else {
    if(attempts[selectedImage]>=5){
      resultDisplay.textContent=`Wrong! Correct was ${audioLabels[correct-1]}`;
      resultDisplay.className='wrong';
      answeredImages.add(selectedImage);
      selectedImage=null;
      imageDisplay.innerHTML='';
    } else {
      resultDisplay.textContent=`Wrong! ${5-attempts[selectedImage]} tries left.`;
      resultDisplay.className='wrong';
    }
  }
  scoreDisplay.textContent=`Score: ${totalScore}`;
  if(answeredImages.size===imageCount){
    gameOverDisplay.textContent=`Game Over! Final Score: ${totalScore}`;
  }
  updateAnswerHints();
}

// üé¨ End Menu
const endMenu=document.getElementById('end-menu');
document.getElementById('go-home').onclick=()=>location.href="https://hatoniwa.github.io/movideo-docks-ccmovid/gg-intro.html";
document.getElementById('watch-yt').onclick=()=>window.open("https://youtube.com/shorts/RWDKpdzjJR8?si=71wkebsKxwHqCh_1","_blank");
document.getElementById('cancel-end').onclick=()=>endMenu.style.display='none';
endBtn.onclick=()=>endMenu.style.display='flex';

// üéµ BGM toggle
bgmToggle.onclick=()=>{
  if(bgmPlaying){ bgm.pause(); bgmToggle.textContent="üéµ Play BGM"; }
  else { bgm.volume=0.5; bgm.play().catch(()=>{}); bgmToggle.textContent="üîá Stop BGM"; }
  bgmPlaying=!bgmPlaying;
};

setupImageButtons();
setupAudioButtons();
updateAnswerHints();
showAnswersCheckbox.addEventListener('change',updateAnswerHints);
</script>
</body>
</html>